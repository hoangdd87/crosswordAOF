<html>
<head>
    <meta charset="UTF-8">
    <title>Server-sent events demo</title>
</head>
<body>
<button>Close the connection</button>

<ul>
</ul>

<script>
    var button = document.querySelector('button');
    var evtSource = new EventSource('getmessagenotseen.php');
    console.log(evtSource.withCredentials);
    console.log(evtSource.readyState);
    console.log(evtSource.url);
    var eventList = document.querySelector('ul');
    evtSource.onopen = function () {
        console.log("Connection to server opened.");
    };
    /*evtSource.onmessage = function(e) {
     var newElement = document.createElement("li");
     newElement.textContent = "message: " + e.data;
     eventList.appendChild(newElement);
     }*/
    evtSource.onerror = function () {
        console.log("EventSource failed.");
    };
    button.onclick = function () {
        console.log('Connection closed');
        evtSource.close();
    }
    evtSource.addEventListener("ping", function (e) {

        var arr = JSON.parse(e.data);
        for (var i = 0; i < arr.length; i++) {
            var newElement = document.createElement("li");
            newElement.innerHTML = "ping at " + arr[i]['teamname'];
            eventList.appendChild(newElement);
        }
    }, false);
</script>
</body>
</html>
